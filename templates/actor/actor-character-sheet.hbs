<form class="{{cssClass}} flexcol" autocomplete="off">
  
  {{!-- Main Container --}}
  <div class="sheet-main-container">
    
    {{!-- Left Side: Portrait & Basic Info --}}
    <div class="portrait-section">
      <div class="portrait-wrapper">
        <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}} (클릭하여 이미지 변경)"/>
      </div>
      
      <div class="basic-info">
        <div class="info-row">
          <label>이름</label>
          <input name="system.info.name" type="text" value="{{system.info.name}}"/>
        </div>
        <div class="info-row">
          <label>가문</label>
          <input name="system.info.family" type="text" value="{{system.info.family}}"/>
        </div>
        <div class="info-row">
          <label>성별</label>
          <input name="system.info.gender" type="text" value="{{system.info.gender}}"/>
        </div>
        <div class="info-row">
          <label>연령</label>
          <input name="system.info.age" type="text" value="{{system.info.age}}"/>
        </div>
        <div class="info-row">
          <label>신장</label>
          <input name="system.info.height" type="text" value="{{system.info.height}}"/>
        </div>
        <div class="info-row">
          <label>체중</label>
          <input name="system.info.weight" type="text" value="{{system.info.weight}}"/>
        </div>
        <div class="info-row">
          <label>직업</label>
          <input name="system.info.occupation" type="text" value="{{system.info.occupation}}"/>
        </div>
        <div class="info-row">
          <label>종족</label>
          <input name="system.info.race" type="text" value="{{system.info.race}}"/>
        </div>
        <div class="info-row">
          <label>초월 경로</label>
          <input name="system.info.transcendentPath" type="text" value="{{system.info.transcendentPath}}"/>
        </div>
        <div class="info-row">
          <label>서열</label>
          <select name="system.info.currentRank">
            {{#each ranks as |label key|}}
            <option value="{{key}}" {{#if (eq ../system.info.currentRank key)}}selected{{/if}}>{{label}}</option>
            {{/each}}
          </select>
        </div>
        <div class="info-row">
          <label>힘 가산치</label>
          <input name="system.info.strengthDamageBonus" type="number" value="{{system.info.strengthDamageBonus}}"/>
        </div>
        <div class="info-row">
          <label>위계</label>
          <input name="system.info.hierarchy" type="text" value="{{system.info.hierarchy}}"/>
        </div>
      </div>
    </div>

    {{!-- Center: Attributes & Stats --}}
    <div class="center-section">
      
      {{!-- Attributes --}}
      <div class="attributes-block">
        <h3 class="block-title">속성</h3>
        <div class="attributes-row">
          {{#each system.attributes as |attr key|}}
          <div class="attr-cell">
            <label class="attr-label">{{lookup ../attributeNames key}}</label>
            <div class="attr-inputs">
              <input name="system.attributes.{{key}}.initial" type="number" value="{{attr.initial}}" title="초기" class="attr-initial"/>
              <input name="system.attributes.{{key}}.value" type="number" value="{{attr.value}}" title="현재" class="attr-current"/>
            </div>
            <button type="button" class="attr-roll-btn rollable" data-attribute="{{key}}" data-label="{{lookup ../attributeNames key}}">
              <i class="fas fa-dice-d20"></i>
            </button>
          </div>
          {{/each}}
        </div>
      </div>

      {{!-- Stats Bar --}}
      <div class="stats-block">
        <div class="stat-row">
          <div class="stat-cell resource">
            <label>영성</label>
            <div class="resource-inputs">
              <input name="system.stats.spirituality.value" type="number" value="{{system.stats.spirituality.value}}" class="current"/>
              <span>/</span>
              <input name="system.stats.spirituality.max" type="number" value="{{system.stats.spirituality.max}}" class="max"/>
            </div>
          </div>
          <div class="stat-cell resource">
            <label>이성</label>
            <div class="resource-inputs">
              <input name="system.stats.sanity.value" type="number" value="{{system.stats.sanity.value}}" class="current"/>
              <span>/</span>
              <input name="system.stats.sanity.max" type="number" value="{{system.stats.sanity.max}}" class="max"/>
            </div>
            <button type="button" class="sanity-roll-btn" title="이성 판정">
              <i class="fas fa-dice-d20"></i>
            </button>
          </div>
          <div class="stat-cell resource">
            <label>생명력</label>
            <div class="resource-inputs">
              <input name="system.stats.hp.value" type="number" value="{{system.stats.hp.value}}" class="current"/>
              <span>/</span>
              <input name="system.stats.hp.max" type="number" value="{{system.stats.hp.max}}" class="max"/>
            </div>
          </div>
        </div>
        <div class="stat-row">
          <div class="stat-cell single">
            <label>이동</label>
            <div class="stat-value">{{system.stats.movement.value}}</div>
          </div>
          <div class="stat-cell single">
            <label>물리방어</label>
            <div class="stat-value">{{system.stats.defensePhysical.value}}</div>
          </div>
          <div class="stat-cell single">
            <label>의지방어</label>
            <div class="stat-value">{{system.stats.defenseWillpower.value}}</div>
          </div>
          <div class="stat-cell single">
            <label>건강방어</label>
            <div class="stat-value">{{system.stats.defenseHealth.value}}</div>
          </div>
        </div>
        <div class="action-buttons">
          <button type="button" class="initiative-roll" title="우선권 굴림">
            <i class="fas fa-fist-raised"></i> 우선권
          </button>
          <button type="button" class="open-actions" title="행동 시트">
            <i class="fas fa-bolt"></i> 행동
          </button>
        </div>
      </div>

      {{!-- Items & Abilities --}}
      <div class="items-abilities-block">
        <div class="items-section">
          <h4 class="sub-title">
            물품
            <button type="button" class="add-btn" data-type="item"><i class="fas fa-plus"></i></button>
          </h4>
          <div class="items-list">
            {{#each items as |item id|}}
            <div class="item-entry" data-item-id="{{item._id}}">
              <span class="item-name">{{item.name}}</span>
              <span class="item-size">{{lookup ../itemSizes item.system.size}}</span>
              <div class="item-actions">
                <a class="item-control item-edit" title="편집"><i class="fas fa-edit"></i></a>
                <a class="item-control item-delete" title="삭제"><i class="fas fa-trash"></i></a>
              </div>
            </div>
            {{/each}}
          </div>
        </div>

        <div class="abilities-section">
          <h4 class="sub-title">
            초월 능력
            <button type="button" class="add-btn" data-type="ability"><i class="fas fa-plus"></i></button>
          </h4>
          <div class="abilities-list">
            {{#each abilities as |item id|}}
            <div class="ability-entry" data-item-id="{{item._id}}">
              <span class="ability-name">{{item.name}}</span>
              <span class="ability-cost">{{item.system.cost}}</span>
              <div class="ability-actions">
                <a class="item-control item-roll" title="사용"><i class="fas fa-hand-sparkles"></i></a>
                <a class="item-control item-edit" title="편집"><i class="fas fa-edit"></i></a>
                <a class="item-control item-delete" title="삭제"><i class="fas fa-trash"></i></a>
              </div>
            </div>
            {{/each}}
          </div>
        </div>
      </div>
    </div>

    {{!-- Right Side: Skills --}}
    <div class="skills-section">
      <h3 class="block-title">기능</h3>
      <div class="skills-container">
        
        {{!-- 힘 --}}
        <div class="skill-column">
          <h4 class="skill-attr-title">힘</h4>
          {{#each system.skills.strength as |skill skillKey|}}
          <div class="skill-row">
            <label class="skill-name">
              {{#if (eq skillKey "melee1")}}
                {{#if skill.name}}{{skill.name}}{{else}}격투{{/if}}
              {{else if (eq skillKey "melee2")}}
                {{#if skill.name}}{{skill.name}}{{else}}격투{{/if}}
              {{else}}
                {{lookup ../../skillNames.strength.[skillKey]}}
              {{/if}}
            </label>
            <select name="system.skills.strength.{{skillKey}}.level" class="skill-level">
              {{#each ../../skillLevels as |label level|}}
              <option value="{{level}}" {{#if (eq ../skill.level level)}}selected{{/if}}>{{label}}</option>
              {{/each}}
            </select>
            <span class="skill-bonus">{{skillBonus skill.level}}</span>
            <button type="button" class="skill-roll rollable" data-attribute="strength" data-skill="{{skillKey}}" data-label="{{#if skill.name}}{{skill.name}}{{else}}{{lookup ../../skillNames.strength.[skillKey]}}{{/if}}">
              <i class="fas fa-dice-d20"></i>
            </button>
            {{#if (eq skillKey "melee1")}}
            <input name="system.skills.strength.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "melee2")}}
            <input name="system.skills.strength.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{/if}}
          </div>
          {{/each}}
        </div>

        {{!-- 민첩 --}}
        <div class="skill-column">
          <h4 class="skill-attr-title">민첩</h4>
          {{#each system.skills.dexterity as |skill skillKey|}}
          <div class="skill-row">
            <label class="skill-name">
              {{#if (eq skillKey "ranged1")}}
                {{#if skill.name}}{{skill.name}}{{else}}사격{{/if}}
              {{else if (eq skillKey "ranged2")}}
                {{#if skill.name}}{{skill.name}}{{else}}사격{{/if}}
              {{else if (eq skillKey "ranged3")}}
                {{#if skill.name}}{{skill.name}}{{else}}사격{{/if}}
              {{else}}
                {{lookup ../../skillNames.dexterity.[skillKey]}}
              {{/if}}
            </label>
            <select name="system.skills.dexterity.{{skillKey}}.level" class="skill-level">
              {{#each ../../skillLevels as |label level|}}
              <option value="{{level}}" {{#if (eq ../skill.level level)}}selected{{/if}}>{{label}}</option>
              {{/each}}
            </select>
            <span class="skill-bonus">{{skillBonus skill.level}}</span>
            <button type="button" class="skill-roll rollable" data-attribute="dexterity" data-skill="{{skillKey}}" data-label="{{#if skill.name}}{{skill.name}}{{else}}{{lookup ../../skillNames.dexterity.[skillKey]}}{{/if}}">
              <i class="fas fa-dice-d20"></i>
            </button>
            {{#if (eq skillKey "ranged1")}}
            <input name="system.skills.dexterity.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "ranged2")}}
            <input name="system.skills.dexterity.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "ranged3")}}
            <input name="system.skills.dexterity.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{/if}}
          </div>
          {{/each}}
        </div>

        {{!-- 영감 --}}
        <div class="skill-column">
          <h4 class="skill-attr-title">영감</h4>
          {{#each system.skills.inspiration as |skill skillKey|}}
          <div class="skill-row">
            <label class="skill-name">
              {{#if (eq skillKey "art1")}}
                {{#if skill.name}}{{skill.name}}{{else}}예술{{/if}}
              {{else if (eq skillKey "art2")}}
                {{#if skill.name}}{{skill.name}}{{else}}예술{{/if}}
              {{else if (eq skillKey "art3")}}
                {{#if skill.name}}{{skill.name}}{{else}}예술{{/if}}
              {{else}}
                {{lookup ../../skillNames.inspiration.[skillKey]}}
              {{/if}}
            </label>
            <select name="system.skills.inspiration.{{skillKey}}.level" class="skill-level">
              {{#each ../../skillLevels as |label level|}}
              <option value="{{level}}" {{#if (eq ../skill.level level)}}selected{{/if}}>{{label}}</option>
              {{/each}}
            </select>
            <span class="skill-bonus">{{skillBonus skill.level}}</span>
            <button type="button" class="skill-roll rollable" data-attribute="inspiration" data-skill="{{skillKey}}" data-label="{{#if skill.name}}{{skill.name}}{{else}}{{lookup ../../skillNames.inspiration.[skillKey]}}{{/if}}">
              <i class="fas fa-dice-d20"></i>
            </button>
            {{#if (eq skillKey "art1")}}
            <input name="system.skills.inspiration.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "art2")}}
            <input name="system.skills.inspiration.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "art3")}}
            <input name="system.skills.inspiration.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{/if}}
          </div>
          {{/each}}
        </div>

        {{!-- 교육 --}}
        <div class="skill-column">
          <h4 class="skill-attr-title">교육</h4>
          {{#each system.skills.education as |skill skillKey|}}
          <div class="skill-row">
            <label class="skill-name">
              {{#if (eq skillKey "scholarship1")}}
                {{#if skill.name}}{{skill.name}}{{else}}학식{{/if}}
              {{else if (eq skillKey "scholarship2")}}
                {{#if skill.name}}{{skill.name}}{{else}}학식{{/if}}
              {{else if (eq skillKey "scholarship3")}}
                {{#if skill.name}}{{skill.name}}{{else}}학식{{/if}}
              {{else if (eq skillKey "scholarship4")}}
                {{#if skill.name}}{{skill.name}}{{else}}학식{{/if}}
              {{else if (eq skillKey "scholarship5")}}
                {{#if skill.name}}{{skill.name}}{{else}}학식{{/if}}
              {{else if (eq skillKey "scholarship6")}}
                {{#if skill.name}}{{skill.name}}{{else}}학식{{/if}}
              {{else if (eq skillKey "occultLanguage1")}}
                {{#if skill.name}}{{skill.name}}{{else}}신비학 언어{{/if}}
              {{else if (eq skillKey "occultLanguage2")}}
                {{#if skill.name}}{{skill.name}}{{else}}신비학 언어{{/if}}
              {{else if (eq skillKey "occultLanguage3")}}
                {{#if skill.name}}{{skill.name}}{{else}}신비학 언어{{/if}}
              {{else if (eq skillKey "occultLanguage4")}}
                {{#if skill.name}}{{skill.name}}{{else}}신비학 언어{{/if}}
              {{else if (eq skillKey "commonLanguage1")}}
                {{#if skill.name}}{{skill.name}}{{else}}상용어{{/if}}
              {{else if (eq skillKey "commonLanguage2")}}
                {{#if skill.name}}{{skill.name}}{{else}}상용어{{/if}}
              {{else if (eq skillKey "commonLanguage3")}}
                {{#if skill.name}}{{skill.name}}{{else}}상용어{{/if}}
              {{else if (eq skillKey "commonLanguage4")}}
                {{#if skill.name}}{{skill.name}}{{else}}상용어{{/if}}
              {{else}}
                {{lookup ../../skillNames.education.[skillKey]}}
              {{/if}}
            </label>
            <select name="system.skills.education.{{skillKey}}.level" class="skill-level">
              {{#each ../../skillLevels as |label level|}}
              <option value="{{level}}" {{#if (eq ../skill.level level)}}selected{{/if}}>{{label}}</option>
              {{/each}}
            </select>
            <span class="skill-bonus">{{skillBonus skill.level}}</span>
            <button type="button" class="skill-roll rollable" data-attribute="education" data-skill="{{skillKey}}" data-label="{{#if skill.name}}{{skill.name}}{{else}}{{lookup ../../skillNames.education.[skillKey]}}{{/if}}">
              <i class="fas fa-dice-d20"></i>
            </button>
            {{#if (eq skillKey "scholarship1")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "scholarship2")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "scholarship3")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "scholarship4")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "scholarship5")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "scholarship6")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "occultLanguage1")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "occultLanguage2")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "occultLanguage3")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "occultLanguage4")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "commonLanguage1")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "commonLanguage2")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "commonLanguage3")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{else if (eq skillKey "commonLanguage4")}}
            <input name="system.skills.education.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="이름" class="skill-custom-name"/>
            {{/if}}
          </div>
          {{/each}}
        </div>

        {{!-- 매력 --}}
        <div class="skill-column">
          <h4 class="skill-attr-title">매력</h4>
          {{#each system.skills.charm as |skill skillKey|}}
          <div class="skill-row">
            <label class="skill-name">{{lookup ../../skillNames.charm.[skillKey]}}</label>
            <select name="system.skills.charm.{{skillKey}}.level" class="skill-level">
              {{#each ../../skillLevels as |label level|}}
              <option value="{{level}}" {{#if (eq ../skill.level level)}}selected{{/if}}>{{label}}</option>
              {{/each}}
            </select>
            <span class="skill-bonus">{{skillBonus skill.level}}</span>
            <button type="button" class="skill-roll rollable" data-attribute="charm" data-skill="{{skillKey}}" data-label="{{lookup ../../skillNames.charm.[skillKey]}}">
              <i class="fas fa-dice-d20"></i>
            </button>
          </div>
          {{/each}}
        </div>

      </div>
    </div>

  </div>

</form>
