<form class="{{cssClass}} flexcol" autocomplete="off">
  
  {{!-- Sheet Header --}}
  <header class="sheet-header">
    <div class="header-top">
      <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="80" width="80"/>
      <div class="header-info">
        <div class="header-row">
          <div class="form-group compact">
            <label>이름</label>
            <input name="system.info.name" type="text" value="{{system.info.name}}" placeholder="이름"/>
          </div>
          <div class="form-group compact">
            <label>가문</label>
            <input name="system.info.family" type="text" value="{{system.info.family}}" placeholder="가문"/>
          </div>
          <div class="form-group compact">
            <label>직업</label>
            <input name="system.info.occupation" type="text" value="{{system.info.occupation}}" placeholder="직업"/>
          </div>
          <div class="form-group compact">
            <label>종족</label>
            <input name="system.info.race" type="text" value="{{system.info.race}}" placeholder="종족"/>
          </div>
        </div>
        <div class="header-row">
          <div class="form-group compact small">
            <label>성별</label>
            <input name="system.info.gender" type="text" value="{{system.info.gender}}" placeholder="성별"/>
          </div>
          <div class="form-group compact small">
            <label>연령</label>
            <input name="system.info.age" type="text" value="{{system.info.age}}" placeholder="연령"/>
          </div>
          <div class="form-group compact small">
            <label>신장</label>
            <input name="system.info.height" type="text" value="{{system.info.height}}" placeholder="신장"/>
          </div>
          <div class="form-group compact small">
            <label>체중</label>
            <input name="system.info.weight" type="text" value="{{system.info.weight}}" placeholder="체중"/>
          </div>
          <div class="form-group compact">
            <label>초월 경로</label>
            <input name="system.info.transcendentPath" type="text" value="{{system.info.transcendentPath}}" placeholder="초월 경로"/>
          </div>
          <div class="form-group compact small">
            <label>서열</label>
            <select name="system.info.currentRank">
              {{#each ranks as |label key|}}
              <option value="{{key}}" {{#if (eq ../system.info.currentRank key)}}selected{{/if}}>{{label}}</option>
              {{/each}}
            </select>
          </div>
          <div class="form-group compact small">
            <label>힘 가산치</label>
            <input name="system.info.strengthDamageBonus" type="number" value="{{system.info.strengthDamageBonus}}" placeholder="0"/>
          </div>
          <div class="form-group compact small">
            <label>위계</label>
            <input name="system.info.hierarchy" type="text" value="{{system.info.hierarchy}}" placeholder="위계"/>
          </div>
        </div>
      </div>
    </div>
  </header>

  {{!-- Stats Bar --}}
  <div class="stats-bar-compact">
    <div class="stat-group">
      <div class="stat-item resource-stat">
        <label>영성</label>
        <div class="stat-values">
          <input name="system.stats.spirituality.value" type="number" value="{{system.stats.spirituality.value}}"/>
          <span>/</span>
          <input name="system.stats.spirituality.max" type="number" value="{{system.stats.spirituality.max}}"/>
        </div>
      </div>
      <div class="stat-item resource-stat">
        <label>이성</label>
        <div class="stat-values">
          <input name="system.stats.sanity.value" type="number" value="{{system.stats.sanity.value}}"/>
          <span>/</span>
          <input name="system.stats.sanity.max" type="number" value="{{system.stats.sanity.max}}"/>
        </div>
        <button type="button" class="sanity-roll mini-btn" title="이성 판정">
          <i class="fas fa-dice-d20"></i>
        </button>
      </div>
      <div class="stat-item resource-stat">
        <label>생명력</label>
        <div class="stat-values">
          <input name="system.stats.hp.value" type="number" value="{{system.stats.hp.value}}"/>
          <span>/</span>
          <input name="system.stats.hp.max" type="number" value="{{system.stats.hp.max}}"/>
        </div>
      </div>
    </div>
    <div class="stat-group">
      <div class="stat-item single-stat">
        <label>이동</label>
        <div class="stat-display">{{system.stats.movement.value}}</div>
      </div>
      <div class="stat-item single-stat">
        <label>물리 방어</label>
        <div class="stat-display">{{system.stats.defensePhysical.value}}</div>
      </div>
      <div class="stat-item single-stat">
        <label>의지 방어</label>
        <div class="stat-display">{{system.stats.defenseWillpower.value}}</div>
      </div>
      <div class="stat-item single-stat">
        <label>건강 방어</label>
        <div class="stat-display">{{system.stats.defenseHealth.value}}</div>
      </div>
    </div>
    <div class="stat-group actions-group">
      <button type="button" class="initiative-roll action-btn" title="우선권 굴림">
        <i class="fas fa-fist-raised"></i> 우선권
      </button>
      <button type="button" class="open-actions action-btn" title="행동 시트 열기">
        <i class="fas fa-bolt"></i> 행동 시트
      </button>
    </div>
  </div>

  {{!-- Main Content - 2 Column Layout --}}
  <div class="sheet-content">
    
    {{!-- Left Column: Attributes & Skills --}}
    <div class="left-column">
      
      {{!-- Attributes Section --}}
      <div class="attributes-compact">
        <h3 class="section-header">속성</h3>
        <div class="attributes-grid-compact">
          {{#each system.attributes as |attr key|}}
          <div class="attribute-compact">
            <div class="attr-header">
              <label>{{lookup ../attributeNames key}}</label>
              <button type="button" class="attribute-roll mini-roll" data-attribute="{{key}}" data-label="{{lookup ../attributeNames key}}">
                <i class="fas fa-dice-d20"></i>
              </button>
            </div>
            <div class="attr-values">
              <input name="system.attributes.{{key}}.value" type="number" value="{{attr.value}}" title="현재"/>
              <span class="sep">/</span>
              <input name="system.attributes.{{key}}.initial" type="number" value="{{attr.initial}}" title="초기"/>
            </div>
          </div>
          {{/each}}
        </div>
      </div>

      {{!-- Skills Section --}}
      <div class="skills-compact">
        <h3 class="section-header">기능</h3>
        
        {{#each system.skills as |attrSkills attrKey|}}
        <div class="skill-category">
          <h4 class="category-title">{{lookup ../attributeNames attrKey}}</h4>
          <div class="skill-list-compact">
            {{#each attrSkills as |skill skillKey|}}
            <div class="skill-compact">
              <div class="skill-name-box">
                {{#if (eq skillKey "melee1")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="격투"/>
                {{else if (eq skillKey "melee2")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="격투"/>
                {{else if (eq skillKey "ranged1")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="사격"/>
                {{else if (eq skillKey "ranged2")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="사격"/>
                {{else if (eq skillKey "ranged3")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="사격"/>
                {{else if (eq skillKey "art1")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="예술"/>
                {{else if (eq skillKey "art2")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="예술"/>
                {{else if (eq skillKey "art3")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="예술"/>
                {{else if (eq skillKey "scholarship1")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="학식"/>
                {{else if (eq skillKey "scholarship2")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="학식"/>
                {{else if (eq skillKey "scholarship3")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="학식"/>
                {{else if (eq skillKey "scholarship4")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="학식"/>
                {{else if (eq skillKey "scholarship5")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="학식"/>
                {{else if (eq skillKey "scholarship6")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="학식"/>
                {{else if (eq skillKey "occultLanguage1")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="신비학 언어"/>
                {{else if (eq skillKey "occultLanguage2")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="신비학 언어"/>
                {{else if (eq skillKey "occultLanguage3")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="신비학 언어"/>
                {{else if (eq skillKey "occultLanguage4")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="신비학 언어"/>
                {{else if (eq skillKey "commonLanguage1")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="상용어"/>
                {{else if (eq skillKey "commonLanguage2")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="상용어"/>
                {{else if (eq skillKey "commonLanguage3")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="상용어"/>
                {{else if (eq skillKey "commonLanguage4")}}
                <input class="skill-custom-input" name="system.skills.{{attrKey}}.{{skillKey}}.name" type="text" value="{{skill.name}}" placeholder="상용어"/>
                {{else}}
                <span class="skill-label">{{lookup ../../skillNames.[attrKey].[skillKey]}}</span>
                {{/if}}
              </div>
              <select class="skill-select" name="system.skills.{{attrKey}}.{{skillKey}}.level">
                {{#each ../../skillLevels as |label level|}}
                <option value="{{level}}" {{#if (eq ../skill.level level)}}selected{{/if}}>{{label}}</option>
                {{/each}}
              </select>
              <span class="skill-bonus-display">{{skillBonus skill.level}}</span>
              <button type="button" class="skill-roll mini-roll" data-attribute="{{attrKey}}" data-skill="{{skillKey}}" data-label="{{#if skill.name}}{{skill.name}}{{else}}{{lookup ../../skillNames.[attrKey].[skillKey]}}{{/if}}">
                <i class="fas fa-dice-d20"></i>
              </button>
            </div>
            {{/each}}
          </div>
        </div>
        {{/each}}
      </div>
    </div>

    {{!-- Right Column: Items & Abilities --}}
    <div class="right-column">
      
      {{!-- Items Section --}}
      <div class="items-compact">
        <h3 class="section-header">
          물품
          <button type="button" class="item-create mini-add" data-type="item">
            <i class="fas fa-plus"></i>
          </button>
        </h3>
        <div class="items-list-compact">
          {{#each items as |item id|}}
          <div class="item-row" data-item-id="{{item._id}}">
            <span class="item-name">{{item.name}}</span>
            <span class="item-size-label">{{lookup ../itemSizes item.system.size}}</span>
            <div class="item-controls-inline">
              <a class="item-control item-edit" title="편집"><i class="fas fa-edit"></i></a>
              <a class="item-control item-delete" title="삭제"><i class="fas fa-trash"></i></a>
            </div>
          </div>
          {{/each}}
        </div>
      </div>

      {{!-- Abilities Section --}}
      <div class="abilities-compact">
        <h3 class="section-header">
          초월 능력
          <button type="button" class="item-create mini-add" data-type="ability">
            <i class="fas fa-plus"></i>
          </button>
        </h3>
        <div class="abilities-list-compact">
          {{#each abilities as |item id|}}
          <div class="ability-row" data-item-id="{{item._id}}">
            <span class="ability-name">{{item.name}}</span>
            <span class="ability-cost">{{item.system.cost}}</span>
            <div class="item-controls-inline">
              <a class="item-control item-roll" title="사용"><i class="fas fa-hand-sparkles"></i></a>
              <a class="item-control item-edit" title="편집"><i class="fas fa-edit"></i></a>
              <a class="item-control item-delete" title="삭제"><i class="fas fa-trash"></i></a>
            </div>
          </div>
          {{/each}}
        </div>
      </div>

    </div>
  </div>

</form>
